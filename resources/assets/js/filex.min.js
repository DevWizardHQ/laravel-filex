!function(window,document){"use strict";function initializeFilex(){if("undefined"==typeof Dropzone)return void console.error("Dropzone.js library not loaded");document.querySelectorAll(".filex-uploader[data-component-id]").forEach((function(filexElement){const componentId=filexElement.dataset.componentId,hiddenInputsContainer=document.getElementById(componentId+"-hidden-inputs"),statusElement=document.getElementById(componentId+"-status");if(!filexElement)return void console.error("Filex element not found:",componentId);const parentForm=filexElement.closest("form"),submitButtons=parentForm?parentForm.querySelectorAll('button[type="submit"], input[type="submit"]'):[];let activeUploads=0,uploadedFiles=[],failedFiles=[],retryCount={};const config={maxFilesize:parseFloat(filexElement.dataset.maxFilesize)||10,maxFiles:filexElement.dataset.maxFiles?parseInt(filexElement.dataset.maxFiles):null,acceptedFiles:filexElement.dataset.acceptedFiles||null,multiple:"true"===filexElement.dataset.multiple,name:filexElement.dataset.name||"files",disk:filexElement.dataset.disk||"public",targetDirectory:filexElement.dataset.targetDirectory||"uploads"},existingInputs=hiddenInputsContainer?hiddenInputsContainer.querySelectorAll(".existing-file-input"):[],existingFiles=Array.from(existingInputs).map((input=>input.value));existingFiles&&existingFiles.length>0&&(uploadedFiles=[...existingFiles]);const hiddenInputName=config.multiple?config.name+"[]":config.name,dropzoneConfig={url:window.filexRoutes?window.filexRoutes.upload:"/filex/upload/temp",method:"POST",headers:{"X-CSRF-TOKEN":getCSRFToken()},paramName:"file",maxFilesize:config.maxFilesize,maxFiles:config.maxFiles,acceptedFiles:config.acceptedFiles,addRemoveLinks:!0,autoProcessQueue:!0,parallelUploads:2,uploadMultiple:!1,chunking:!0,chunkSize:1048576,parallelChunkUploads:!1,retryChunks:!0,retryChunksLimit:3,forceChunking:function(file){return file.size>52428800},retries:3,timeout:3e4,thumbnailWidth:120,thumbnailHeight:120,thumbnailMethod:"contain",dictRemoveFile:"",accept:function(file,done){done()},init:function(){const dz=this;existingFiles.forEach((function(filePath,index){const fileName=filePath.split("/").pop(),mockFile={name:fileName,size:0,accepted:!0,processing:!1,upload:{progress:100},status:Dropzone.SUCCESS,tempPath:filePath,isExisting:!0};if(dz.emit("addedfile",mockFile),dz.emit("complete",mockFile),mockFile.previewElement){const iconSvg=getFileIconSvg(fileName.split(".").pop().toLowerCase()),imageElement=mockFile.previewElement.querySelector(".dz-image");!imageElement||mockFile.type&&mockFile.type.startsWith("image/")||(imageElement.innerHTML=iconSvg)}const removeButton=mockFile.previewElement?mockFile.previewElement.querySelector(".dz-remove"):null;removeButton&&removeButton.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),dz.removeFile(mockFile)})),mockFile.previewElement&&mockFile.previewElement.classList.add("filex-preview-existing")})),dz.on("addedfile",(function(file){if(file.previewElement&&!file.isExisting){file.previewElement.classList.add("filex-preview-new");const successMark=document.createElement("div");successMark.className="dz-success-mark",successMark.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16"><circle cx="12" cy="12" r="10" fill="#28a745"/><path fill="white" d="M9 12l2 2 4-4" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',successMark.style.display="none",successMark.style.visibility="hidden",file.previewElement.appendChild(successMark);const errorMark=document.createElement("div");errorMark.className="dz-error-mark",errorMark.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16"><circle cx="12" cy="12" r="10" fill="#dc3545"/><path fill="white" d="M12 8v4M12 16h.01" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',errorMark.style.display="none",errorMark.style.visibility="hidden",file.previewElement.appendChild(errorMark)}if(file.isExisting||function(file){const errors=[];if(file.size>1024*config.maxFilesize*1024&&errors.push("File is too large"),config.acceptedFiles){const acceptedTypes=config.acceptedFiles.split(",").map((type=>type.trim()));let isValidType=!1;for(const acceptedType of acceptedTypes)if(acceptedType.includes("*")){const pattern=acceptedType.replace("*","");if(file.type&&file.type.startsWith(pattern)){isValidType=!0;break}}else if(acceptedType.startsWith(".")){if("."+file.name.split(".").pop().toLowerCase()===acceptedType.toLowerCase()){isValidType=!0;break}}else if(file.type===acceptedType){isValidType=!0;break}isValidType||errors.push("File type not allowed")}if(errors.length>0){if(file.previewElement){file.previewElement.classList.add("dz-error");const errorElement=file.previewElement.querySelector(".dz-error-message");errorElement&&(errorElement.textContent=errors.join(", "));const errorMark=file.previewElement.querySelector(".dz-error-mark"),successMark=file.previewElement.querySelector(".dz-success-mark");errorMark&&(errorMark.style.display="flex",errorMark.style.visibility="visible",errorMark.style.opacity="1"),successMark&&(successMark.style.display="none",successMark.style.visibility="hidden",successMark.style.opacity="0")}return!1}return!0}(file)){if(file.status===Dropzone.SUCCESS||file.isExisting||(activeUploads++,updateFormState(),updateStatus()),!file.type||!file.type.startsWith("image/")){const iconSvg=getFileIconSvg(file.name.split(".").pop().toLowerCase()),imageElement=file.previewElement?file.previewElement.querySelector(".dz-image"):null;imageElement&&(imageElement.innerHTML=iconSvg)}if(file.previewElement){const retryButton=document.createElement("button");retryButton.type="button",retryButton.className="dz-retry",retryButton.style.display="none",retryButton.title="Retry upload",retryButton.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14"><path fill="currentColor" d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/></svg>',retryButton.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),retryUpload(file)})),file.previewElement.appendChild(retryButton)}}})),dz.on("success",(function(file,response){if(response&&response.success&&response.tempPath){if(file.tempPath=response.tempPath,file.originalName=response.originalName,file.serverSize=response.size,file.status=Dropzone.SUCCESS,file.previewElement){const preview=file.previewElement,progressEl=preview.querySelector(".dz-progress"),errorEl=preview.querySelector(".dz-error-message"),retryBtn=preview.querySelector(".dz-retry"),successMark=preview.querySelector(".dz-success-mark"),errorMark=preview.querySelector(".dz-error-mark");preview.classList.remove("dz-processing","dz-error"),preview.classList.add("dz-success"),setTimeout((()=>{preview&&file.status===Dropzone.SUCCESS&&(preview.classList.remove("dz-processing","dz-error"),preview.classList.add("dz-success"))}),100),progressEl&&(progressEl.style.display="none"),errorEl&&(errorEl.style.display="none",errorEl.textContent=""),retryBtn&&(retryBtn.style.display="none"),successMark&&(successMark.style.display="flex",successMark.style.visibility="visible",successMark.style.opacity="1"),errorMark&&(errorMark.style.display="none",errorMark.style.visibility="hidden",errorMark.style.opacity="0")}uploadedFiles.push(response.tempPath),updateHiddenInputs();const failedIndex=failedFiles.findIndex((f=>f.name===file.name));failedIndex>-1&&failedFiles.splice(failedIndex,1),delete retryCount[file.name]}else if(file.previewElement){file.previewElement.classList.add("dz-error");const errorMsg=response&&response.message?response.message:"Upload failed",errorElement=file.previewElement.querySelector(".dz-error-message");errorElement&&(errorElement.textContent=errorMsg)}activeUploads--,updateFormState(),updateStatus()})),dz.on("error",(function(file,errorMessage,xhr){if(activeUploads--,failedFiles.find((f=>f.name===file.name))||failedFiles.push({name:file.name,error:errorMessage,file:file}),file.previewElement){const preview=file.previewElement,retryBtn=preview.querySelector(".dz-retry"),errorMark=preview.querySelector(".dz-error-mark"),successMark=preview.querySelector(".dz-success-mark");preview.classList.remove("dz-success","dz-processing"),preview.classList.add("dz-error"),retryBtn&&(retryBtn.style.display="flex"),errorMark&&(errorMark.style.display="flex",errorMark.style.visibility="visible",errorMark.style.opacity="1"),successMark&&(successMark.style.display="none",successMark.style.visibility="hidden",successMark.style.opacity="0")}updateFormState(),updateStatus()})),dz.on("complete",(function(file){file.previewElement&&(file.status===Dropzone.SUCCESS?(file.previewElement.classList.remove("dz-processing","dz-error"),file.previewElement.classList.add("dz-success")):file.status===Dropzone.ERROR&&(file.previewElement.classList.remove("dz-processing","dz-success"),file.previewElement.classList.add("dz-error")))})),dz.on("removedfile",(function(file){if(file.tempPath){const index=uploadedFiles.indexOf(file.tempPath);if(index>-1&&uploadedFiles.splice(index,1),!file.isExisting&&window.filexRoutes&&window.filexRoutes.delete){const filename=file.tempPath.split("/").pop(),deleteUrl=window.filexRoutes.delete.replace("__FILENAME__",encodeURIComponent(filename));fetch(deleteUrl,{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":getCSRFToken()}}).catch((error=>{console.error("Failed to delete temp file:",error)}))}}const failedIndex=failedFiles.findIndex((f=>f.name===file.name));failedIndex>-1&&failedFiles.splice(failedIndex,1),updateHiddenInputs(),updateStatus()})),dz.on("maxfilesexceeded",(function(file){dz.removeFile(file),alert("Maximum number of files exceeded")}))}},myFilex=new Dropzone(filexElement,dropzoneConfig);function retryUpload(file){const currentRetries=retryCount[file.name]||0;if(currentRetries>=3)return void alert("Maximum retry attempts reached for "+file.name);retryCount[file.name]=currentRetries+1;const retryButton=file.previewElement?file.previewElement.querySelector(".dz-retry"):null;retryButton&&(retryButton.style.display="none"),file.status=Dropzone.QUEUED,file.previewElement&&file.previewElement.classList.remove("dz-error");const failedIndex=failedFiles.findIndex((f=>f.name===file.name));failedIndex>-1&&failedFiles.splice(failedIndex,1),activeUploads++,updateFormState(),updateStatus(),myFilex.processFile(file)}function updateHiddenInputs(){if(!hiddenInputsContainer)return;const existingInputs=hiddenInputsContainer.querySelectorAll(".existing-file-input");hiddenInputsContainer.innerHTML="",existingInputs.forEach((input=>hiddenInputsContainer.appendChild(input))),uploadedFiles.forEach((function(filePath){const input=document.createElement("input");input.type="hidden",input.name=hiddenInputName,input.value=filePath,input.className="uploaded-file-input",hiddenInputsContainer.appendChild(input)}))}function updateFormState(){activeUploads>0?submitButtons.forEach((btn=>{btn.disabled=!0,btn.dataset.originalText||(btn.dataset.originalText=btn.textContent),btn.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" class="spinning-icon"><path fill="currentColor" d="M12,4V2A10,10 0 0,0 2,12H4A8,8 0 0,1 12,4Z"/></svg> Uploading...'})):submitButtons.forEach((btn=>{btn.disabled=!1,btn.dataset.originalText&&(btn.textContent=btn.dataset.originalText,delete btn.dataset.originalText)}))}function updateStatus(){if(!statusElement)return;const uploadingText=statusElement.querySelector(".uploading-text"),completedText=statusElement.querySelector(".completed-text"),errorText=statusElement.querySelector(".error-text");if(activeUploads>0)statusElement.style.display="block",uploadingText&&(uploadingText.style.display="inline"),completedText&&(completedText.style.display="none"),errorText&&(errorText.style.display="none");else if(failedFiles.length>0){if(statusElement.style.display="block",uploadingText&&(uploadingText.style.display="none"),completedText&&(completedText.style.display="none"),errorText){errorText.style.display="inline";const errorMessage=errorText.querySelector(".error-message");errorMessage&&(errorMessage.textContent=failedFiles.length+" file(s) failed to upload")}}else uploadedFiles.length>0?(statusElement.style.display="block",uploadingText&&(uploadingText.style.display="none"),completedText&&(completedText.style.display="inline"),errorText&&(errorText.style.display="none")):statusElement.style.display="none"}filexElement.addEventListener("click",(function(e){if(e.target.matches(".dz-remove")||e.target.closest(".dz-remove")){e.preventDefault(),e.stopPropagation();const preview=(e.target.matches(".dz-remove")?e.target:e.target.closest(".dz-remove")).closest(".dz-preview");preview&&preview._file&&myFilex.removeFile(preview._file)}if(e.target.matches(".dz-retry")||e.target.closest(".dz-retry")){e.preventDefault(),e.stopPropagation();const preview=(e.target.matches(".dz-retry")?e.target:e.target.closest(".dz-retry")).closest(".dz-preview");preview&&preview._file&&retryUpload(preview._file)}})),window[componentId]=myFilex,parentForm&&parentForm.addEventListener("submit",(function(e){return filexElement.classList.contains("required")&&0===uploadedFiles.length?(e.preventDefault(),alert("Please upload at least one file."),!1):activeUploads>0?(e.preventDefault(),alert("Please wait for all files to finish uploading."),!1):failedFiles.length>0&&!confirm("Some files failed to upload. Do you want to continue without them?")?(e.preventDefault(),!1):void 0})),window[componentId+"_helpers"]={getUploadedFiles:()=>uploadedFiles,getFailedFiles:()=>failedFiles,retryFailedUploads:()=>{failedFiles.forEach((failed=>{retryUpload(failed.file)}))},clearAll:()=>{myFilex.removeAllFiles(),uploadedFiles=[],failedFiles=[],updateHiddenInputs(),updateStatus()}}}))}function getFileIconSvg(extension){return{pdf:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48"><path fill="#dc3545" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/><text x="12" y="16" text-anchor="middle" fill="white" font-size="6" font-weight="bold">PDF</text></svg>',doc:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48"><path fill="#2b579a" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/><text x="12" y="16" text-anchor="middle" fill="white" font-size="5" font-weight="bold">DOC</text></svg>',docx:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48"><path fill="#2b579a" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/><text x="12" y="16" text-anchor="middle" fill="white" font-size="5" font-weight="bold">DOC</text></svg>',xls:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48"><path fill="#107c41" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/><text x="12" y="16" text-anchor="middle" fill="white" font-size="6" font-weight="bold">XLS</text></svg>',xlsx:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48"><path fill="#107c41" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/><text x="12" y="16" text-anchor="middle" fill="white" font-size="6" font-weight="bold">XLS</text></svg>',ppt:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48"><path fill="#d24726" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/><text x="12" y="16" text-anchor="middle" fill="white" font-size="6" font-weight="bold">PPT</text></svg>',pptx:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48"><path fill="#d24726" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/><text x="12" y="16" text-anchor="middle" fill="white" font-size="6" font-weight="bold">PPT</text></svg>',txt:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48"><path fill="#6c757d" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/><text x="12" y="16" text-anchor="middle" fill="white" font-size="6" font-weight="bold">TXT</text></svg>',zip:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48"><path fill="#6c757d" d="M14,17H12V15H14M14,13H12V11H14M12,9H14V7H12M12,19H14V17H12M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/><text x="12" y="16" text-anchor="middle" fill="white" font-size="6" font-weight="bold">ZIP</text></svg>',jpg:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48"><path fill="#6f42c1" d="M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z"/></svg>',jpeg:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48"><path fill="#6f42c1" d="M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z"/></svg>',png:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48"><path fill="#6f42c1" d="M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z"/></svg>',mp3:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48"><path fill="#20c997" d="M14,3.23V5.29C16.89,6.15 19,8.83 19,12C19,15.17 16.89,17.84 14,18.7V20.77C18,19.86 21,16.28 21,12C21,7.72 18,4.14 14,3.23M16.5,12C16.5,10.23 15.5,8.71 14,7.97V16C15.5,15.29 16.5,13.76 16.5,12M3,9V15H7L12,20V4L7,9H3Z"/></svg>',mp4:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48"><path fill="#fd7e14" d="M17,10.5V7A1,1 0 0,0 16,6H4A1,1 0 0,0 3,7V17A1,1 0 0,0 4,18H16A1,1 0 0,0 17,17V13.5L21,17.5V6.5L17,10.5Z"/></svg>'}[extension.toLowerCase()]||'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48"><path fill="#6c757d" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/></svg>'}function getCSRFToken(){const metaTag=document.querySelector('meta[name="csrf-token"]');return metaTag?metaTag.getAttribute("content"):""}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initializeFilex):initializeFilex(),window.Filex={initialize:initializeFilex,getFileIconSvg:getFileIconSvg}}(window,document);